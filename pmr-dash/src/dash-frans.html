<link rel="import"  href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/mqtt-elements/mqtt-elements.html">
<script src="https://d3js.org/d3.v4.min.js"></script>
<dom-module id="dash-frans">
  <template>
  <style>
  paper-card {
    width: 250px;
    margin: 5px;
  }
  .bar {
        fill: #5677fc;
    }
  </style>
    <mqtt-connection auto url="ws://gost.geodan.nl:9001">
        <mqtt-subscription
            topic="Datastreams(32)/Observations"
            number-of-messages="Infinity"
            last-message="{{lastMessageOne}}"
            messages="{{messagesOne}}">
        </mqtt-subscription>
        <mqtt-subscription
            topic="Datastreams(33)/Observations"
            number-of-messages="Infinity"
            last-message="{{lastMessageTwo}}"
            messages="{{messagesTwo}}">
        </mqtt-subscription>
        <mqtt-subscription
            topic="Datastreams(34)/Observations"
            number-of-messages="Infinity"
            last-message="{{lastMessageThree}}"
            messages="{{messagesThree}}">
        </mqtt-subscription>
    </mqtt-connection>

    <paper-card class="white" heading$="{{antwoord}}" image="style/frans.png" alt$="{{antwoord}}">
  <div class="card-content">
    <svg width="50" height="60" id="one"><g>
      <path
         d="M 0,3 C 1,3 5,0.36220472 5,3 l 0,49.362205 c 0,1 0,2 2,2 l 33,0 c 2,0 2,-1 2,-2 L 42,3 c 0,-2.63779528 4,0 5,0"
         style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:round;stroke-opacity:1"
         />
      <rect class="bar style-scope dash-frans" x="5" y="53" width="37" height="1" fill="#5677fc"></rect>    
      <path
         d="m 5,7.3622047 37,0"
         style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;opacity:0.5" />
      <path
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
         d="m 5,17.362205 37,0"
       />
      <path
         d="m 5,27.362205 37,0"
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
      <path
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
         d="m 5,37.362205 37,0"/>
      <path
         d="m 5,47.362205 37,0"
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
    </g></svg>
    <svg width="50" height="60" id="two"><path
         d="M 0,3 C 1,3 5,0.36220472 5,3 l 0,49.362205 c 0,1 0,2 2,2 l 33,0 c 2,0 2,-1 2,-2 L 42,3 c 0,-2.63779528 4,0 5,0"
         style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:round;stroke-opacity:1"
         />
      <rect class="bar style-scope dash-frans" x="5" y="53" width="37" height="1" fill="#5677fc"></rect>    
      <path
         d="m 5,7.3622047 37,0"
         style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;opacity:0.5" />
      <path
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
         d="m 5,17.362205 37,0"
       />
      <path
         d="m 5,27.362205 37,0"
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
      <path
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
         d="m 5,37.362205 37,0"/>
      <path
         d="m 5,47.362205 37,0"
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
    </g></svg>
    <svg width="50" height="60" id="three"><path
         d="M 0,3 C 1,3 5,0.36220472 5,3 l 0,49.362205 c 0,1 0,2 2,2 l 33,0 c 2,0 2,-1 2,-2 L 42,3 c 0,-2.63779528 4,0 5,0"
         style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:round;stroke-opacity:1"
         />
      <rect class="bar style-scope dash-frans" x="5" y="53" width="37" height="1" fill="#5677fc"></rect>    
      <path
         d="m 5,7.3622047 37,0"
         style="fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;opacity:0.5" />
      <path
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
         d="m 5,17.362205 37,0"
       />
      <path
         d="m 5,27.362205 37,0"
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
      <path
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
         d="m 5,37.362205 37,0"/>
      <path
         d="m 5,47.362205 37,0"
         style="opacity:0.5;fill:none;fill-rule:evenodd;stroke:#000000;stroke-width:0.25;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" />
    </g></svg>
   
  </div>
</paper-card>

</template>
<script>
  // register a new element called proto-element
  Polymer({
    is: "dash-frans",
    properties: {
        lastMessageOne: {
            type: Object,
            notify: true,
            observer: '_messageOneChanged'
        },
        lastMessageTwo: {
            type: Object,
            notify: true,
            observer: '_messageTwoChanged'
        },
        lastMessageThree: {
            type: Object,
            notify: true,
            observer: '_messageThreeChanged'
        },
        frans: {
            type: String,
            value: 'red',
            notify: true
        }
    },
    // add a callback to the element's prototype
    ready: function() {
        this.antwoord = "water nodig";
        
    },
    _messageOneChanged:function (msg) {
        var data = JSON.parse(msg.parsedPayload);
        this.sensorOne = data.result;
        this._calcDroog();
    },
    _messageTwoChanged:function (msg) {
        var data = JSON.parse(msg.parsedPayload);
        this.sensorTwo = data.result;
        this._calcDroog();
    },
    _messageThreeChanged:function (msg) {
        var data = JSON.parse(msg.parsedPayload);
        this.sensorThree = data.result;
        this._calcDroog();
    },
    _calcDroog: function(){
        console.log('yo');
        var treshold = 550;
        var one = this.sensorOne?this.sensorOne:0;
        var two = this.sensorTwo?this.sensorTwo:0;
        var three = this.sensorThree?this.sensorThree:0;
        if(one<treshold&&two<treshold&&three<treshold) {
            this.antwoord = "geen water nodig";
            this.frans = 'green';
        }
        else {
            this.antwoord = "water nodig";
            this.frans = 'red';
        }

        var data1 = (550-one)/11>0?(550-one)/11:0;
        var data2 = (550-two)/11>0?(550-two)/11:0;
        var data3 = (550-three)/11>0?(550-three)/11:0;
      
        d3.select('#one').select(".bar")            
            .attr("height",data1)
            .attr("y",54-data1)
        d3.select('#two').select(".bar")            
            .attr("height",data2)
            .attr("y",54-data2)
      
        d3.select('#three').select(".bar")            
            .attr("height",data2)
            .attr("y",54-data2)
                  


      

 

    }
  });
</script>
</dom-module>